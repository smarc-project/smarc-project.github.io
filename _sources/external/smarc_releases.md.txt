# smarc_releases
![release](https://github.com/smarc-project/smarc_releases/workflows/release-deb/badge.svg) [![license](https://img.shields.io/badge/License-BSD%203--Clause-blue.svg)](https://opensource.org/licenses/BSD-3-Clause)

CD infrastructure for the SMaRC packages

## Package status

You can check [the released SMARC packages](https://github.com/smarc-project/smarc_releases/blob/noetic-devel/rosdep/noetic/smarc.yaml)
to see if your package has been released. If you want to update one of them or release a new package,
have a look at the [release instructions](https://github.com/smarc-project/rosinstall/blob/master/docs/release_package.md).

| Repository | Build Status | Release Status |
| --- | --- | --- |
| [smarc_releases](https://github.com/smarc-project/smarc_releases)  | - | ![release](https://github.com/smarc-project/smarc_releases/workflows/release-deb/badge.svg) |
| [smarc_msgs](https://github.com/smarc-project/smarc_msgs) | ![CI](https://github.com/smarc-project/smarc_msgs/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/smarc_msgs/workflows/release-CI/badge.svg) |
| [lolo_common](https://github.com/smarc-project/lolo_common/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/lolo_common/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/lolo_common/workflows/release-CI/badge.svg) |
| [imc_ros_bridge](https://github.com/smarc-project/imc_ros_bridge)  | ![CI](https://github.com/smarc-project/imc_ros_bridge/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/imc_ros_bridge/workflows/release-CI/badge.svg) |
| [smarc_navigation](https://github.com/smarc-project/smarc_navigation/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/smarc_navigation/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/smarc_navigation/workflows/release-CI/badge.svg) |
| [smarc_missions](https://github.com/smarc-project/smarc_missions/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/smarc_missions/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/smarc_missions/workflows/release-CI/badge.svg) |
| [sam_common](https://github.com/smarc-project/sam_common/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/sam_common/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/sam_common/workflows/release-CI/badge.svg) |
| [uavcan_ros_bridge](https://github.com/smarc-project/uavcan_ros_bridge)  | ![CI](https://github.com/smarc-project/uavcan_ros_bridge/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/uavcan_ros_bridge/workflows/release-CI/badge.svg) |
| [smarc_utils](https://github.com/smarc-project/smarc_utils/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/smarc_utils/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/smarc_utils/workflows/release-CI/badge.svg) |
| [roswasm_suite](https://github.com/nilsbore/roswasm_suite/blob/master/release_packages.yaml)  | ![CI](https://github.com/nilsbore/roswasm_suite/workflows/CI/badge.svg?branch=master)  | ![release](https://github.com/nilsbore/roswasm_suite/workflows/release-deb/badge.svg) |
| [sam_webgui](https://github.com/smarc-project/sam_webgui)  | ![CI](https://github.com/smarc-project/sam_webgui/workflows/CI/badge.svg?branch=master)  | ![release](https://github.com/smarc-project/sam_webgui/workflows/release-deb/badge.svg) |
| [lolo_webgui](https://github.com/smarc-project/lolo_webgui)  | ![CI](https://github.com/smarc-project/lolo_webgui/workflows/CI/badge.svg?branch=master)  | ![release](https://github.com/smarc-project/lolo_webgui/workflows/release-deb/badge.svg) |
| [stonefish_ros](https://github.com/smarc-project/stonefish_ros)  | ![CI](https://github.com/smarc-project/stonefish_ros/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/stonefish_ros/workflows/release-CI/badge.svg) |
| [smarc_stonefish_sims](https://github.com/smarc-project/smarc_stonefish_sims/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/smarc_stonefish_sims/workflows/CI/badge.svg?branch=noetic-devel) | ![release](https://github.com/smarc-project/smarc_stonefish_sims/workflows/release-CI/badge.svg) |
| [roswasm_suite_native](https://github.com/smarc-project-native-gui/roswasm_suite_native/blob/master/release_packages.yaml)  | Not tested | ![release](https://github.com/smarc-project-native-gui/roswasm_suite_native/workflows/release-CI/badge.svg) |
| [sam_webgui_native](https://github.com/smarc-project-native-gui/sam_webgui_native)  | Not tested  | ![release](https://github.com/smarc-project-native-gui/sam_webgui_native/workflows/release-CI/badge.svg) |
| [lolo_webgui_native](https://github.com/smarc-project-native-gui/lolo_webgui_native)  | Not tested  | ![release](https://github.com/smarc-project-native-gui/lolo_webgui_native/workflows/release-CI/badge.svg) |
| [smarc_controllers](https://github.com/smarc-project/smarc_controllers/blob/noetic-devel/release_packages.yaml)  | ![CI](https://github.com/smarc-project/smarc_controllers/workflows/CI/badge.svg?branch=noetic-devel)  | ![release](https://github.com/smarc-project/smarc_controllers/workflows/release-CI/badge.svg) |
| [smarc_base](https://github.com/smarc-project/smarc_base)  | ![CI](https://github.com/smarc-project/smarc_base/workflows/CI/badge.svg?branch=noetic-devel)  |![release](https://github.com/smarc-project/smarc_base/workflows/release-CI/badge.svg) |
| [smarc_desktop](https://github.com/smarc-project/smarc_desktop)  | Not tested |![release](https://github.com/smarc-project/smarc_desktop/workflows/release-CI/badge.svg) |

## Creating and hosting a release

### Creating a release

In the panel to the right in this repo, click on the "Releases" header. Select "Draft new release". Click on "Choose a tag", create a new unique tag and give it a meaningful title. Click the "Publish release" button.

That is everything required to create a new binary release of all packages. If you wait for about 30-40 minutes, four zip files will appear next to the release in the releases interface.

#### What do the different files contain?

Each release contains four files when the action is done. They will appear one by one:

* `bloom-melodic-release-deb.zip` - Debian packages for ROS melodic, excluding the web GUI packages
* `bloom-noetic-release-deb.zip` - Debian packages for ROS noetic, excluding the web GUI packages
* `bloom-melodic-wasm-release-deb.zip` - Debian packages for ROS melodic, including the web GUI packages
* `bloom-noetic-wasm-release-deb.zip` - Debian packages for ROS noetic, including the web GUI packages

The last two are the ones we typically care about, since they include **all** packages.

#### What happens in the background?

Everything in the release process is automated. A new Github action will be created, called `release-deb`.
If you click on the "Actions" panel for this repo (positioned above) you should be able to view the `release-deb`
action triggered by the release creation.

The action will try to make a release of all packages enumerated in the [release_repos.yaml](https://github.com/smarc-project/smarc_releases/blob/noetic-devel/release_repos.yaml) file as well as the [release_repos_gui.yaml](https://github.com/smarc-project/smarc_releases/blob/noetic-devel/release_repos_gui.yaml) file. It builds debian packages for each package, and bundles them in a zip file that gets presented in the releases interface when the action is done. If successful, it will also update the minor package version in the repos of all released packages using the [@smarcbot](https://github.com/smarcbot) user.

### Hosting a release

1. Clone this repository: `git clone https://github.com/smarc-project/smarc_releases.git`
2. Go to the scripts repo: `cd smarc_releases/scripts`
3. Execute `./make_package_repository.sh` to create a apt package folder within the current folder containing the release packages from this repo (it downloads `bloom-noetic-wasm-release-deb.zip` and `bloom-melodic-wasm-release-deb.zip` from the latest release)
4. Execute `./serve_package_repository.sh` to serve the package repository from your computer. This will typically be executed from the server at KTH
5. Test that it works by following the install instructions
